!function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t){e.exports=require("express")},function(e,t){e.exports=require("request")},function(e,t,n){"use strict";var s=n(3);t.getHash=function(e){return n(16).createHmac("sha256","thequickfoxjumpedoverthelazydog").update(e).digest("hex")},t.isValidEmail=function(e){return/\S+@\S+\.\S+/.test(e)},t.isValidMSISDN=function(e){if(10===e.length){var t=s.toArray(e),n=s.map(t,function(e){if(s.toUpper(e)!==s.toLower(e))return console.log("Text contains alphabets"),!1});return!s.includes(n,!1)}return!1}},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var s=n(5),r={IP:process.env.SERVER_IP||"localhost",PORT:process.env.SERVER_PORT||8001},u=new s(process.env.DB_NAME||"dedup",process.env.DB_USER||"root",process.env.DB_PASSWORD||"",{host:process.env.DB_HOST||"localhost",dialect:process.env.DB_DIALECT||"mysql",pool:{max:5,min:0,idle:1e4}});e.exports={config:r,sequelize:u}},function(e,t){e.exports=require("sequelize")},function(e,t,n){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),i=n(0),a=r(i),f=n(7),l=r(f),d=n(8),c=r(d),p=n(9),h=r(p),y=n(10),m=r(y),v=n(11),g=r(v),M=n(12),b=r(M),_=n(13),w=r(_),O=n(14),j=r(O),S=n(15),x=r(S),T=n(17),q=r(T),R=n(18),P=s(R),D=n(4),E=s(D),I=n(1),U=(r(I),function(){function e(){u(this,e),this.app=(0,a.default)(),this.initExpress(this.app),this.initSQLAndRouters(this.app),this.finalize(this.app)}return o(e,[{key:"initExpress",value:function(e){e.use(c.default.json({limit:"50mb"})),e.use(c.default.urlencoded({limit:"50mb",extended:!0})),e.use((0,l.default)()),e.use((0,g.default)([])),e.use((0,m.default)({resave:!0,saveUninitialized:!0,secret:"thequickbrownfoxjumpedoverthelazydogs",cookieName:"session",duration:18e5,activeDuration:3e5,httpOnly:!0,cookie:{secure:!1}})),e.use(function(e,t,n){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.header("Access-Control-Allow-Methods","POST, GET, PUT, DELETE, OPTIONS"),n()}),e.use((0,h.default)("dev")),e.use(a.default.static("build")),e.use(function(e,t,n){t.header("Cache-Control","private, no-cache, no-store, must-revalidate"),t.header("Expires","-1"),t.header("Pragma","no-cache"),n()}),e.get("/",function(e,t){t.redirect("./index.html")})}},{key:"validate",value:function(e,t,n){if(e.session&&e.session.user){var s=E.sequelize;P.usersModel(s).findOne({where:{id:e.session.user.id,password:e.session.user.password}}).then(function(e){e?n():t.status(404).send("no session found")})}else t.status(404).send("please login")}},{key:"initSQLAndRouters",value:function(e){var t=E.sequelize,n=P.orgModel(t),s=P.managersModel(t),r=P.officersModel(t),u=P.usersModel(t);s.belongsTo(u),s.belongsTo(n),r.belongsTo(u),r.belongsTo(s),t.sync({force:!0});var o=new b.default(u),i=new w.default(s),a=new j.default(r,s,u),f=new x.default(u,s,r),l=new q.default(u);e.use("/api/v1/users",o.routes()),e.use("/api/v1/managers",i.routes()),e.use("/api/v1/officers",a.routes()),e.use("/api/v1/utils",f.routes()),e.use("/api/sessions",l.routes())}},{key:"finalize",value:function(e){var t=E.config.PORT;e.listen(parseInt(t),function(){console.log("Running on PORT ::: "+t)})}}]),e}());t.default=U;new U},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("express-validator")},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(u),i=function(){function e(t){s(this,e),this.UsersModel=t}return r(e,[{key:"routes",value:function(){var e=this,t=o.default.Router();return t.route("/").get(function(t,n){e.UsersModel.findAll().then(function(e){n.status(200).json("success")})}),t.route("/:id").get(function(e,t){}),t.route("/email/:email").get(function(e,t){}),t.route("/").post(function(t,n){0!=Object.keys(t.body)?e.UsersModel.create(t.body).then(function(e){n.status(200).json(e)}):0!=Object.keys(t.params)&&e.UsersModel.create(t.params).then(function(e){n.status(200).json(e)})}),t.route("/:id").delete(function(e,t){}),t}}]),e}();t.default=i},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(u),i=function(){function e(t){s(this,e),this.Manager=t}return r(e,[{key:"routes",value:function(){var e=this,t=o.default.Router();return t.route("/").get(function(t,n){e.Manager.findAll({where:{status:"A"},limit:100}).then(function(e){delete e.password,n.status(200).json(e)})}),t.route("/:id").get(function(t,n){e.Manager.findById(t.params.id).then(function(e){delete e.password,n.status(200).json(e)})}),t.route("/user_id/:user_id").get(function(t,n){e.Manager.findOne({where:{user_id:t.params.user_id}}).then(function(e){delete e.password,n.status(200).json(e)})}),t.route("/").post(function(t,n){t.body?(t.body.type="M",e.UserModel.create(t.body).then(function(s){s?(t.body.user_id=s.id,e.Manager.create(t.body).then(function(e){n.status(200).json(e)})):n.status(400).send("request failed")})):n.status(200).send("Data not saved!")}),t.route("/:id").delete(function(t,n){e.Manager.update({status:"D"},{where:{id:t.params.id}}).then(function(e){n.status(200).json(e)})}),t}}]),e}();t.default=i},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=n(0),i=s(o),a=n(1),f=(s(a),function(){function e(t,n,s){r(this,e),this.OfficerModel=t,this.ManagersModel=n,this.UserModel=s}return u(e,[{key:"routes",value:function(){var e=this,t=i.default.Router();return t.route("/").get(function(t,n){e.OfficerModel.findAll({where:{status:"A"},limit:100,include:[e.ManagersModel]}).then(function(e){n.status(200).json(e)})}),t.route("/:id").get(function(t,n){e.OfficerModel.findById(t.params.id).then(function(e){n.status(200).json(e)})}),t.route("/user_id/:user_id").get(function(t,n){e.OfficerModel.findOne({where:{user_id:t.params.user_id},include:[e.ManagersModel]}).then(function(e){n.status(200).json(e)})}),t.route("/").post(function(t,n){t.body?(t.body.type="O",e.UserModel.create(t.body).then(function(s){s?(t.body.user_id=s.id,e.OfficerModel.create(t.body).then(function(e){n.status(200).json(e)})):n.status(400).send("request failed")})):n.status(200).send("Data not saved!")}),t.route("/:id").delete(function(e,t){}),t}}]),e}());t.default=f},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),o=n(0),i=s(o),a=n(1),f=(s(a),function(){function e(t,n,s){r(this,e),this.UsersModel=t,this.ManagersModel=n,this.OfficersModel=s}return u(e,[{key:"getUserDetails",value:function(e,t){"M"===t.type?this.ManagersModel.findOne({where:{user_id:t.id}}).then(function(n){if(n){var s={firstname:n.firstname,type:t.type,user_id:t.id,msisdn:t.msisdn};e.status(200).json(s)}else e.status(200).send("no details found")}):"O"===t.type?this.OfficersModel.findOne({where:{user_id:t.id}}).then(function(n){if(n){var s={firstname:n.firstname,type:t.type,user_id:t.id,msisdn:t.msisdn};e.status(200).json(s)}else e.status(200).send("no details found")}):e.status(404).send("user type unknown")}},{key:"routes",value:function(){var e=this,t=this,s=i.default.Router(),r=n(2);return s.route("/login").get(function(n,s){n.query&&n.query.username&&n.query.password?r.isValidEmail(n.query.username)?t.UsersModel.findOne({where:{email:n.query.username,password:r.getHash(n.query.password)}}).then(function(t){t?(e.getUserDetails(s,t),n.session.user=t):s.status(200).json(t),e.getUserDetails(s,t)}):r.isValidMSISDN(n.query.username)?t.UsersModel.findOne({where:{msisdn:n.query.username,password:r.getHash(n.query.password)}}).then(function(t){t?(e.getUserDetails(s,t),n.session.user=t):s.status(200).json(t)}):s.status(200).send("Username SHOULD either be an EMAIL or MSISDN(should be 10 digit in length)"):s.status(200).send("Data not received")}),s.route("/is_email_exist/:email").get(function(e,n){r.isValidEmail(e.params.email)?t.UsersModel.findOne({where:{email:e.params.email}}).then(function(e){e?n.status(200).json({is_exist:!0}):n.status(200).json({is_exist:!1})}):n.status(404).send("Wrong EMAIL format")}),s.route("/is_msisdn_exist/:msisdn").get(function(e,n){r.isValidMSISDN(e.params.msisdn)?t.UsersModel.findOne({where:{msisdn:e.params.msisdn}}).then(function(e){e?n.status(200).json({is_exist:!0}):n.status(200).json({is_exist:!1})}):n.status(200).json("Wrong MSISN format")}),s}}]),e}());t.default=f},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(u),i=n(4),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i),f=function(){function e(t){s(this,e),this.UsersModel=t}return r(e,[{key:"routes",value:function(){var e=this,t=o.default.Router(),s=n(2);return t.route("/register").get(function(t,n){a.config.sessions_username,a.config.sessions_password;e.UsersModel.findOne({where:{msisdn:"0244000000",password:s.getHash("000000")}}).then(function(e){e?(t.session.user=e,n.status(200).json({session:!0})):n.status(404).json("sessions error")})}),t.route("/:id").get(function(e,t){t.status(200).send("not implemented")}),t}}]),e}();t.default=f},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e){return e.define("organisations",{name:{type:f.default.STRING},status:{type:f.default.STRING(1)}},{underscored:!0})}function u(e){return e.define("managers",{firstname:{type:f.default.STRING,set:function(e){this.setDataValue("firstname",d.default.capitalize(e).trim())}},lastname:{type:f.default.STRING,set:function(e){this.setDataValue("lastname",d.default.capitalize(e).trim())}},status:{type:f.default.STRING(1),defaultValue:"A"}},{underscored:!0})}function o(e){return e.define("officers",{firstname:{type:f.default.STRING,set:function(e){this.setDataValue("firstname",d.default.capitalize(e).trim())}},lastname:{type:f.default.STRING,set:function(e){this.setDataValue("lastname",d.default.capitalize(e).trim())}},status:{type:f.default.STRING(1),defaultValue:"A"}},{underscored:!0})}function i(e){return e.define("users",{email:{type:f.default.STRING,unique:!0,validate:{isEmail:!0}},msisdn:{type:f.default.STRING,unique:!0,validate:{isNumeric:!0}},type:{type:f.default.ENUM,values:["M","O"]},password:{type:f.default.STRING,set:function(e){this.setDataValue("password",c.getHash(e))}},status:{type:f.default.STRING(1),defaultValue:"A"}},{underscored:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.orgModel=r,t.managersModel=u,t.officersModel=o,t.usersModel=i;var a=n(5),f=s(a),l=n(3),d=s(l),c=n(2)}]);